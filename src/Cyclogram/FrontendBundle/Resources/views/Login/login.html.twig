{% extends '::base.html.twig' %}

{% block javascripts %}

<script type="text/javascript">
        function goLogIn(){
            window.location = "{{ path('_fb_security_check') }}";
        }

        function onFbInit() {
            if (typeof(FB) != 'undefined' && FB != null ) {
                FB.Event.subscribe('auth.statusChange', function(response) {
                    setTimeout(goLogIn, 500);
                });
            }
            FB.Event.subscribe('auth.logout',
                     function(response) {
                         if (response.status === 'unknown')  {
                            window.location = "{{ path('_logout') }}";
                          }
            });                            
        }

        function fb_login() {
            FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
                    // connected
                    alert('Already connected, redirect to login page to create token.');
                    document.location = "{{ url("hwi_oauth_service_redirect", {service: "facebook"}) }}";
                } else {
                    // not_authorized
                    FB.login(function(response) {
                        if (response.authResponse) {
                            document.location = "{{ url("hwi_oauth_service_redirect", {service: "facebook"}) }}";
                        } else {
                            alert('Cancelled.');
                        }
                    });
                }
            });
        }


        
        
        $(document).ready(function(){
            $('#facebook_button').click(function()
                 { 
                     fb_login();
                 });

            $('#expand_google_form').click(function()
                {
                    alert('hello');
                });

            
        });
</script> 

{% endblock javascripts %}

{% block content %}
        <script type="text/javascript">
            window.fbAsyncInit = function() {
                FB.init({
                    "appId":"584886061542799",
                    "xfbml":true,
                    "oauth":true,
                    "status":true,
                    "cookie":true,
                    "logging":true});
            };
            
            // Load the SDK asynchronously
            (function(d, s, id){
               var js, fjs = d.getElementsByTagName(s)[0];
               if (d.getElementById(id)) {return;}
               js = d.createElement(s); js.id = id;
               js.src = "//connect.facebook.net/en_US/all.js";
               fjs.parentNode.insertBefore(js, fjs);
             }(document, 'script', 'facebook-jssdk'));
        </script>

		<div class="mobile_reg login_form">
			
			<div class="wrapper">
			
				<h1>{% trans from "login" %}txt_log_in{% endtrans %}</h1>
				
				<div class="loginform_left">
				
					<div class="btns_wapper">
						<form>
{# 						{{ facebook_login_button({'autologoutlink': true}, 'CyclogramFrontendBundle:Facebook:loginButton.html.twig') }}#}
						<a id="facebook_button" class="btn_reg fb" href="#">
                            <span>Login with Facebook</span>
                        </a>
{# 							<a class="btn_reg fb" href="#"><span>Login with Facebook</span></a>#}
						</form>
						<form>
							<a id="expand_google_form" class="btn_reg google" href="#"><span>Login with Google</span></a>
						</form>	
					</div>
					<div class="notice2"><p><span>{% trans from "login" %}txt_login_securely{% endtrans %}</span></p></div>
				
				</div>
				
				<div class="sep">
					{% trans from "login" %}txt_or{% endtrans %}
				</div>
				
				<div class="loginform_right">
					<form action="{{ path('login_check') }}" method="post">
					    <a class="forgot" href="{{ path('_forgot_username', {'studyId': studyId}) }}">{% trans from "login" %}txt_forgot_your_username{% endtrans %}</a>
						<label for="reg_field_1">{% trans from "login" %}txt_form_username{% endtrans %}</label>
						<span class="input_placeholder "><input type="text" class="text " value="{{ last_username }}" id="reg_field_1" name="_username" ><span class="mark"></span></span>
						<label for="reg_field_2">{% trans from "login" %}txt_form_password{% endtrans %}</label><a class="forgot" tabIndex="-1" href="{{ path('_forgot_pass', {'studyId': studyId}) }}">{% trans from "login" %}txt_forgot_your_password{% endtrans %}</a>
						<span class="input_placeholder"><input type="password" class="text" name="_password" id="reg_field_2"><span class="mark"></span></span>
						{% if error %}<div><p class="error">{%  trans from "login" %}txt_login_error_message{% endtrans %}</p></div>{% endif %}
						<div class="actions_row">
							<input type="checkbox" value="" class="checkbox" name="">{%  trans from "login" %}txt_stay_logged_in{% endtrans %}
							<button type="submit" class="submit btn_login">{% trans from "login" %}txt_login_button{% endtrans %}</button>
						</div>
						
					</form>
				</div>			
			
			</div>
		</div>
		<div class="login_btn_placeholder">{% trans from "login" %}havent_joined{% endtrans %} <a href="{{ path('_registration') }}">Register</a></div>
		
{#         {% render(controller('HWIOAuthBundle:Connect:connect')) %}#}
		
		
{% endblock content %}
