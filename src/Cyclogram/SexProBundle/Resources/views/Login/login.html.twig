{% extends '::base.html.twig' %}

{% block javascripts %}
    <script>
        function goLogIn(){
            window.location = "{{ path('_fb_security_check') }}";
        }

        function onFbInit() {
            if (typeof(FB) != 'undefined' && FB != null ) {
                FB.Event.subscribe('auth.statusChange', function(response) {
                    setTimeout(goLogIn, 500);
                });
            }
            FB.Event.subscribe('auth.logout',
                function(response) {
                    if (response.status === 'unknown')  {
                        window.location = "{{ path('_logout') }}";
                    }
                });                            
            }
    </script> 
{% endblock javascripts %}

{% block body %}
    <body class="has_image">
		{{ facebook_initialize({'async': true, 'xfbml': true, 'fbAsyncInit': 'onFbInit();'}) }}
		<div class="reg_header">
			<a href="http://proofpilot.com/" class="logo">ProofPilot</a>
		</div>
		
		<div class="mobile_reg login_form">
			
			<div class="wrapper">
			
				<h1>Log in</h1>
				
				<div class="loginform_left">
				
					<div class="btns_wapper">
						<form>
						    {{ facebook_login_button({'autologoutlink': true}) }}
						</form>
						<form>
							<a id="expand_google_form" class="btn_reg google" href="#"><span>Login with Google</span></a>
						</form>	
					</div>
					<div class="notice2"><p><span>Login Securely with your accounts.</span></p></div>
				
				</div>
				
				<div class="sep">
					OR
				</div>
				
				<div class="loginform_right">
				
					<form action="{{ path('login_check') }}" method="post">
					    <a class="forgot" href="forgot_username.html">Forgot your username?</a>
						<label for="reg_field_1">Username</label>
						<span class="input_placeholder "><input type="text" class="text " value="{{ last_username }}" id="reg_field_1" name="_username" ><span class="mark"></span></span>
						<label for="reg_field_2">Password</label><a class="forgot" href="forgot_your_password.html">Forgot your password?</a>
						<span class="input_placeholder"><input type="password" class="text" name="_password" id="reg_field_2"><span class="mark"></span></span>
						<div class="actions_row">
							<input type="checkbox" value="" class="checkbox" name=""> Stay logged in
							<a id="login_submit" class="submit btn_login">LOGIN</a>
							<button type="submit" style="display:none" id="submit_button"></button>
						</div>
						{% if error %}<div>{{ error.message }}</div>{% endif %}
					</form>
					
				</div>
				
			</div>
			
		</div>
		<script>
            $(document).ready(function(){
                $('#login_submit').click(function() {
                    $('#submit_button').trigger('click');
                        return false;
                    });
    
                $('#facebook_button').click(function() { 
                    FB.login(null, {scope: "email"});
                });
            });
		</script>
    </body>
{% endblock body %}
